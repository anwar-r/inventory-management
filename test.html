<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SR & SONS - Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .logo {
            width: 100px;
            height: 100px;
            margin: 20px auto;
            display: block;
        }
        button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #b91c1c;
        }
    </style>
</head>
<body>
    <h1>SR & SONS - System Test</h1>
    
    <div class="test-section">
        <h2>üìÅ File Structure Test</h2>
        <div id="fileTest"></div>
    </div>

    <div class="test-section">
        <h2>üé® Logo Test</h2>
        <img src="assets/logo.svg" alt="SR Logo" class="logo">
        <p>If you can see the red circular logo with "SR" text above, the logo is working correctly.</p>
    </div>

            <div class="test-section">
            <h2>üìä Data Manager Test</h2>
            <button onclick="testDataManager()">Test Data Manager</button>
            <button onclick="testCRUD()">Test CRUD Operations</button>
            <button onclick="debugData()">Debug Data</button>
            <button onclick="clearData()">Clear All Data</button>
            <div id="dataTest"></div>
        </div>

    <div class="test-section">
        <h2>üì± PWA Test</h2>
        <button onclick="testPWA()">Test PWA Features</button>
        <div id="pwaTest"></div>
    </div>

    <div class="test-section">
        <h2>üñºÔ∏è Image Upload Test</h2>
        <button onclick="testImageUpload()">Test Image Upload</button>
        <button onclick="testImagePersistence()">Test Image Persistence</button>
        <div id="imageTest"></div>
    </div>

    <div class="test-section">
        <h2>üîó Navigation</h2>
        <button onclick="window.open('index.html', '_blank')">Open Main App</button>
        <p>Click the button above to open the main inventory management application.</p>
    </div>

    <script src="js/database.js"></script>
    <script>
        // Test file structure
        function testFileStructure() {
            const files = [
                'index.html',
                'manifest.json',
                'sw.js',
                'js/database.js',
                'assets/logo.svg'
            ];
            
            const results = [];
            files.forEach(file => {
                fetch(file)
                    .then(response => {
                        if (response.ok) {
                            results.push(`‚úÖ ${file} - Found`);
                        } else {
                            results.push(`‚ùå ${file} - Not found`);
                        }
                        updateFileTest(results);
                    })
                    .catch(() => {
                        results.push(`‚ùå ${file} - Error loading`);
                        updateFileTest(results);
                    });
            });
        }

        function updateFileTest(results) {
            const div = document.getElementById('fileTest');
            div.innerHTML = results.join('<br>');
        }

        // Test database manager
        async function testDataManager() {
            const div = document.getElementById('dataTest');
            div.innerHTML = 'Testing...';
            
            try {
                await databaseManager.init();
                const products = databaseManager.getAllProducts();
                const stats = databaseManager.getStats();
                
                div.innerHTML = `
                    <div class="success">‚úÖ Database Manager loaded successfully</div>
                    <div>üì¶ Products loaded: ${products.length}</div>
                    <div>üìä Total Products: ${stats.totalProducts}</div>
                    <div>üìÇ Categories: ${stats.totalCategories}</div>
                    <div>üí∞ Average Price: ‚Çπ${stats.avgPrice}</div>
                `;
            } catch (error) {
                div.innerHTML = `<div class="error">‚ùå Database Manager test failed: ${error.message}</div>`;
            }
        }

        // Test CRUD operations
        async function testCRUD() {
            const div = document.getElementById('dataTest');
            div.innerHTML = 'Testing CRUD operations...';
            
            try {
                // Test Create
                const testProduct = {
                    name: "Test Product",
                    category: "Test Category",
                    gst: 18,
                    master: 10,
                    inner: 5,
                    mrp: 100,
                    dp: 50
                };
                
                const addedProduct = await databaseManager.addProduct(testProduct);
                
                // Test Read
                const readProduct = databaseManager.getProductById(addedProduct.id);
                
                // Test Update
                const updatedProduct = await databaseManager.updateProduct(addedProduct.id, {
                    ...readProduct,
                    name: "Updated Test Product"
                });
                
                // Test Delete
                await databaseManager.deleteProduct(addedProduct.id);
                
                div.innerHTML = `
                    <div class="success">‚úÖ CRUD Operations Test Passed!</div>
                    <div>‚úÖ Create: Product added with ID ${addedProduct.id}</div>
                    <div>‚úÖ Read: Product retrieved successfully</div>
                    <div>‚úÖ Update: Product updated to "${updatedProduct.name}"</div>
                    <div>‚úÖ Delete: Product deleted successfully</div>
                `;
            } catch (error) {
                div.innerHTML = `<div class="error">‚ùå CRUD test failed: ${error.message}</div>`;
            }
        }

        // Debug data function
        async function debugData() {
            const div = document.getElementById('dataTest');
            div.innerHTML = 'Loading debug information...';
            
            try {
                await databaseManager.init();
                const products = databaseManager.getAllProducts();
                const stats = databaseManager.getStats();
                const categories = databaseManager.getAllCategories();
                const dbSize = localStorage.getItem('inventory-database') ? localStorage.getItem('inventory-database').split(',').length : 0;
                
                let imageInfo = '';
                for (const product of products) {
                    const imageData = databaseManager.getImageData(product.id);
                    const hasImage = imageData !== null;
                    imageInfo += `<div>Product ${product.id} (${product.name}): ${hasImage ? '‚úÖ Has Image' : '‚ùå No Image'} - ${product.image_path || 'No path'}</div>`;
                }
                
                div.innerHTML = `
                    <div class="success">üîç Database Debug Information</div>
                    <div>üì¶ Products in database: ${stats.totalProducts}</div>
                    <div>üìÇ Categories in database: ${stats.totalCategories}</div>
                    <div>üí∞ Average Price: ‚Çπ${stats.avgPrice}</div>
                    <div>üíæ Database size: ${dbSize} bytes</div>
                    <div>üîß Database exists: ${localStorage.getItem('inventory-database') ? 'Yes' : 'No'}</div>
                    <div style="margin-top: 10px; font-weight: bold;">Image Status:</div>
                    ${imageInfo}
                `;
            } catch (error) {
                div.innerHTML = `<div class="error">‚ùå Debug failed: ${error.message}</div>`;
            }
        }

        // Clear all data function
        async function clearData() {
            const div = document.getElementById('dataTest');
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                try {
                    await databaseManager.init();
                    databaseManager.clearAllData();
                    div.innerHTML = '<div class="success">‚úÖ All data cleared successfully!</div>';
                } catch (error) {
                    div.innerHTML = `<div class="error">‚ùå Failed to clear data: ${error.message}</div>`;
                }
            }
        }

        // Test PWA features
        function testPWA() {
            const div = document.getElementById('pwaTest');
            const results = [];
            
            // Test service worker support
            if ('serviceWorker' in navigator) {
                results.push('‚úÖ Service Worker supported');
            } else {
                results.push('‚ùå Service Worker not supported');
            }
            
            // Test manifest
            if (document.querySelector('link[rel="manifest"]')) {
                results.push('‚úÖ Manifest link found');
            } else {
                results.push('‚ùå Manifest link not found');
            }
            
            // Test localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                results.push('‚úÖ localStorage working');
            } catch (error) {
                results.push('‚ùå localStorage not working');
            }
            
            div.innerHTML = results.join('<br>');
        }

        // Test Image Upload
        async function testImageUpload() {
            const div = document.getElementById('imageTest');
            div.innerHTML = 'Testing Image Upload...';

            try {
                // Create a test product with image
                const testProduct = {
                    name: "Test Product with Image",
                    category: "Test Category",
                    gst: 18,
                    master: 10,
                    inner: 5,
                    mrp: 100,
                    dp: 50,
                    image: 'https://via.placeholder.com/150?text=Test+Image'
                };
                
                const addedProduct = await dataManager.addProduct(testProduct);
                
                div.innerHTML = `
                    <div class="success">‚úÖ Image Upload Test Passed!</div>
                    <div>‚úÖ Product added with ID: ${addedProduct.id}</div>
                    <div>‚úÖ Image path: ${addedProduct.image}</div>
                    <div>‚úÖ Image data stored: ${dataManager.getImageData(addedProduct.id) ? 'Yes' : 'No'}</div>
                `;
            } catch (error) {
                div.innerHTML = `<div class="error">‚ùå Image Upload Test Failed: ${error.message}</div>`;
            }
        }

        // Test Image Persistence
        async function testImagePersistence() {
            const div = document.getElementById('imageTest');
            div.innerHTML = 'Testing Image Persistence...';

            try {
                // Create a test product
                const testProduct = {
                    name: "Persistence Test Product",
                    category: "Test Category",
                    gst: 18,
                    master: 10,
                    inner: 5,
                    mrp: 100,
                    dp: 50,
                    image: 'https://via.placeholder.com/150?text=Original+Image'
                };
                
                const addedProduct = await dataManager.addProduct(testProduct);
                const originalImage = addedProduct.image;
                
                // Update product without changing image
                const updatedProduct = await dataManager.updateProduct(addedProduct.id, {
                    name: "Updated Persistence Test Product",
                    mrp: 150
                });
                
                const imagePersisted = updatedProduct.image === originalImage;
                const hasImageData = await dataManager.hasImage(addedProduct.id);
                
                div.innerHTML = `
                    <div class="success">‚úÖ Image Persistence Test Completed!</div>
                    <div>‚úÖ Product ID: ${addedProduct.id}</div>
                    <div>‚úÖ Original Image: ${originalImage}</div>
                    <div>‚úÖ Updated Image: ${updatedProduct.image}</div>
                    <div>‚úÖ Image Persisted: ${imagePersisted ? 'Yes' : 'No'}</div>
                    <div>‚úÖ Image Data Exists: ${hasImageData ? 'Yes' : 'No'}</div>
                `;
            } catch (error) {
                div.innerHTML = `<div class="error">‚ùå Image Persistence Test Failed: ${error.message}</div>`;
            }
        }

        // Run initial tests
        window.addEventListener('load', () => {
            testFileStructure();
            testPWA();
        });
    </script>
</body>
</html>
